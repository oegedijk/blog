<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="twitter:card" content="summary" /><!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Callable properties in python | Data science explained</title>
<meta name="generator" content="Jekyll v4.0.0" />
<meta property="og:title" content="Callable properties in python" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="How to make python @property behave like a method" />
<meta property="og:description" content="How to make python @property behave like a method" />
<link rel="canonical" href="https://oegedijk.github.io/blog/python/2020/11/10/callable-properties.html" />
<meta property="og:url" content="https://oegedijk.github.io/blog/python/2020/11/10/callable-properties.html" />
<meta property="og:site_name" content="Data science explained" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2020-11-10T00:00:00-06:00" />
<script type="application/ld+json">
{"description":"How to make python @property behave like a method","@type":"BlogPosting","headline":"Callable properties in python","dateModified":"2020-11-10T00:00:00-06:00","datePublished":"2020-11-10T00:00:00-06:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://oegedijk.github.io/blog/python/2020/11/10/callable-properties.html"},"url":"https://oegedijk.github.io/blog/python/2020/11/10/callable-properties.html","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/blog/assets/css/style.css"><link type="application/atom+xml" rel="alternate" href="https://oegedijk.github.io/blog/feed.xml" title="Data science explained" /><!-- the google_analytics_id gets auto inserted from the config file -->



<script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-21800815-2','auto');ga('require','displayfeatures');ga('send','pageview');</script>

<link rel="shortcut icon" type="image/x-icon" href="/blog/images/favicon.ico"><!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Callable properties in python | Data science explained</title>
<meta name="generator" content="Jekyll v4.0.0" />
<meta property="og:title" content="Callable properties in python" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="How to make python @property behave like a method" />
<meta property="og:description" content="How to make python @property behave like a method" />
<link rel="canonical" href="https://oegedijk.github.io/blog/python/2020/11/10/callable-properties.html" />
<meta property="og:url" content="https://oegedijk.github.io/blog/python/2020/11/10/callable-properties.html" />
<meta property="og:site_name" content="Data science explained" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2020-11-10T00:00:00-06:00" />
<script type="application/ld+json">
{"description":"How to make python @property behave like a method","@type":"BlogPosting","headline":"Callable properties in python","dateModified":"2020-11-10T00:00:00-06:00","datePublished":"2020-11-10T00:00:00-06:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://oegedijk.github.io/blog/python/2020/11/10/callable-properties.html"},"url":"https://oegedijk.github.io/blog/python/2020/11/10/callable-properties.html","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

<link href="https://unpkg.com/@primer/css/dist/primer.css" rel="stylesheet" />
<link rel="stylesheet" href="//use.fontawesome.com/releases/v5.0.7/css/all.css"><link type="application/atom+xml" rel="alternate" href="https://oegedijk.github.io/blog/feed.xml" title="Data science explained" /><!-- the google_analytics_id gets auto inserted from the config file -->



<script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-21800815-2','auto');ga('require','displayfeatures');ga('send','pageview');</script>



<script>
function wrap_img(fn) {
    if (document.attachEvent ? document.readyState === "complete" : document.readyState !== "loading") {
        var elements = document.querySelectorAll(".post img");
        Array.prototype.forEach.call(elements, function(el, i) {
            if (el.getAttribute("title") && (el.className != "emoji")) {
                const caption = document.createElement('figcaption');
                var node = document.createTextNode(el.getAttribute("title"));
                caption.appendChild(node);
                const wrapper = document.createElement('figure');
                wrapper.className = 'image';
                el.parentNode.insertBefore(wrapper, el);
                el.parentNode.removeChild(el);
                wrapper.appendChild(el);
                wrapper.appendChild(caption);
            }
        });
    } else { document.addEventListener('DOMContentLoaded', fn); }
}
window.onload = wrap_img;
</script>

<script>
    document.addEventListener("DOMContentLoaded", function(){
    // add link icon to anchor tags
    var elem = document.querySelectorAll(".anchor-link")
    elem.forEach(e => (e.innerHTML = '<i class="fas fa-link fa-xs"></i>'));
    });
</script>
</head>
<body><header class="site-header">

  <div class="wrapper"><a class="site-title" rel="author" href="/blog/">Data science explained</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/blog/about/">About Me</a><a class="page-link" href="/blog/search/">Search</a><a class="page-link" href="/blog/categories/">Tags</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Callable properties in python</h1><p class="page-description">How to make python @property behave like a method</p><p class="post-meta post-meta-title"><time class="dt-published" datetime="2020-11-10T00:00:00-06:00" itemprop="datePublished">
        Nov 10, 2020
      </time>
       â€¢ <span class="read-time" title="Estimated read time">
    
    
      5 min read
    
</span></p>

    
      <p class="category-tags"><i class="fas fa-tags category-tags-icon"></i></i> 
      
        <a class="category-tags-link" href="/blog/categories/#python">python</a>
        
      
      </p>
    

    
      
        <div class="pb-5 d-flex flex-wrap flex-justify-end">
          <div class="px-2">

    <a href="https://github.com/oegedijk/blog/tree/master/_notebooks/2020-11-10-callable-properties.ipynb" role="button" target="_blank">
<img class="notebook-badge-image" src="/blog/assets/badges/github.svg" alt="View On GitHub">
    </a>
</div>

          <div class="px-2">
    <a href="https://mybinder.org/v2/gh/oegedijk/blog/master?filepath=_notebooks%2F2020-11-10-callable-properties.ipynb" target="_blank">
        <img class="notebook-badge-image" src="/blog/assets/badges/binder.svg" alt="Open In Binder"/>
    </a>
</div>

          <div class="px-2">
    <a href="https://colab.research.google.com/github/oegedijk/blog/blob/master/_notebooks/2020-11-10-callable-properties.ipynb" target="_blank">
        <img class="notebook-badge-image" src="/blog/assets/badges/colab.svg" alt="Open In Colab"/>
    </a>
</div>
        </div>
      </header>

  <div class="post-content e-content" itemprop="articleBody">
    <ul class="section-nav">
<li class="toc-entry toc-h1"><a href="#Why-callable-properties?">Why callable properties? </a></li>
<li class="toc-entry toc-h1"><a href="#Adding-callable-indexes-to-properties">Adding callable indexes to properties </a>
<ul>
<li class="toc-entry toc-h2"><a href="#Enter-callable-default-lists">Enter callable default lists </a>
<ul>
<li class="toc-entry toc-h3"><a href="#Using-pd.DataFrame,-pd.Series-or-np.ndarray-as-list-elements">Using pd.DataFrame, pd.Series or np.ndarray as list elements </a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-entry toc-h1"><a href="#Conclusion">Conclusion </a></li>
</ul><!--
#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: _notebooks/2020-11-10-callable-properties.ipynb
-->

<div class="container" id="notebook-container">
        
    
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Why-callable-properties?">
<a class="anchor" href="#Why-callable-properties?" aria-hidden="true"><span class="octicon octicon-link"></span></a>Why callable properties?<a class="anchor-link" href="#Why-callable-properties?"> </a>
</h1>
<p>First of all: you probably should not use callable properties if you can somehow avoid it :)</p>
<p>The two main reasons to use callable properties in python that I see are the following:</p>
<ol>
<li>Playing around with the dynamic nature of python for the fun of it</li>
<li>You had defined <code>@properties</code> in your API that later on you realized should have been a <code>get_</code> method with a parameter, but you do not want break the old API.</li>
</ol>
<p>(I had a case of no. 2)</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Adding-callable-indexes-to-properties">
<a class="anchor" href="#Adding-callable-indexes-to-properties" aria-hidden="true"><span class="octicon octicon-link"></span></a>Adding callable indexes to properties<a class="anchor-link" href="#Adding-callable-indexes-to-properties"> </a>
</h1>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Suppose we had built ourselves a nice little class that holds a list of fruit. At any given time only one fruit is the selected fruit, indicated by the index <code>self.idx</code>.</p>
<p>We use a <code>@property</code> to return the current selected fruit from the list:</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">FruitList</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fruits</span><span class="p">,</span> <span class="n">idx</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fruits</span> <span class="o">=</span> <span class="n">fruits</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">idx</span> <span class="o">=</span> <span class="n">idx</span>
        
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">selected_fruit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">fruits</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">idx</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">fl</span> <span class="o">=</span> <span class="n">FruitList</span><span class="p">([</span><span class="s1">'apple'</span><span class="p">,</span> <span class="s1">'banana'</span><span class="p">,</span> <span class="s1">'pear'</span><span class="p">],</span> <span class="n">idx</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"init idx == 1, fruit = "</span><span class="p">,</span> <span class="n">fl</span><span class="o">.</span><span class="n">selected_fruit</span><span class="p">)</span>
<span class="n">fl</span><span class="o">.</span><span class="n">idx</span> <span class="o">=</span> <span class="mi">2</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"new idx == 2, fruit = "</span><span class="p">,</span> <span class="n">fl</span><span class="o">.</span><span class="n">selected_fruit</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>init idx == 1, fruit =  banana
new idx == 2, fruit =  pear
</pre>
</div>
</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Your users have been happily using your FruitList class and seem happy with the API, but now a new request comes in: would it be possible to explicitly select a particular fruit by index?</p>
<p>You could ofcourse add a method</p>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_selected_fruit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span> 
    <span class="k">if</span> <span class="n">index</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">fruits</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">]</span>
    <span class="k">else</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">fruits</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">idx</span><span class="p">]</span>
</pre></div>
<p>But now we have duplicate way of getting selected fruit, which makes the API more confusing. You could deprecate the old property, but that might break the API for older users.</p>
<p>So what if there would be a way to keep the old API functional, plus add the new functionality by doing one weird python trick?</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Enter-callable-default-lists">
<a class="anchor" href="#Enter-callable-default-lists" aria-hidden="true"><span class="octicon octicon-link"></span></a>Enter callable default lists<a class="anchor-link" href="#Enter-callable-default-lists"> </a>
</h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We can do this by creating an object that:</p>
<ol>
<li>Is equal to a default index element when not called</li>
<li>Returns the default index oelement when called without parameters</li>
<li>Returns a specific index element when called with an index parameter</li>
</ol>
<p>If the <code>@property</code> would return such an object, then both the old API and new index selector API could be supported by a single <code>@property</code>!</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The trick is creating a new class that is an instance of the default index item (e.g. for <code>'banana'</code> the type would be <code>str</code>), but also contains the full list of fruit, and has a <code>__call__</code> method that returns the right fruit when called with a specific index, and otherwise just returns the default fruit.</p>
<p>Or in Python code:</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span>

<span class="k">def</span> <span class="nf">make_callable_default_list</span><span class="p">(</span><span class="n">source_list</span><span class="p">:</span><span class="n">List</span><span class="p">,</span> <span class="n">default_index</span><span class="p">:</span><span class="nb">int</span><span class="p">):</span>
    <span class="k">class</span> <span class="nc">DefaultList</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">source_list</span><span class="p">[</span><span class="n">default_index</span><span class="p">])):</span>
        <span class="k">def</span> <span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">default_value</span><span class="p">,</span> <span class="n">source_list</span><span class="p">):</span>
            <span class="n">obj</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="n">source_list</span><span class="p">[</span><span class="n">default_index</span><span class="p">])</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">default_value</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">obj</span>

        <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">default_value</span><span class="p">,</span> <span class="n">source_list</span><span class="p">):</span>
            <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">source_list</span> <span class="o">=</span> <span class="n">source_list</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">default_type</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="n">default_value</span><span class="p">)</span>

        <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">index</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">source_list</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">DefaultList</span><span class="p">(</span><span class="n">source_list</span><span class="p">[</span><span class="n">default_index</span><span class="p">],</span> <span class="n">source_list</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Now we simply make the property return such a <code>DefaultList</code>:</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">FruitList</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fruits</span><span class="p">,</span> <span class="n">idx</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fruits</span> <span class="o">=</span> <span class="n">fruits</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">idx</span> <span class="o">=</span> <span class="n">idx</span>
        
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">selected_fruit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">make_callable_default_list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fruits</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">idx</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>When calling <code>selected_fruit</code> as an attribute, it still works the same as before for our old users:</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">fl</span> <span class="o">=</span> <span class="n">FruitList</span><span class="p">([</span><span class="s1">'apple'</span><span class="p">,</span> <span class="s1">'banana'</span><span class="p">,</span> <span class="s1">'pear'</span><span class="p">],</span> <span class="n">idx</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"Init self.idx == 1, fruit = "</span><span class="p">,</span> <span class="n">fl</span><span class="o">.</span><span class="n">selected_fruit</span><span class="p">)</span>
<span class="n">fl</span><span class="o">.</span><span class="n">idx</span> <span class="o">=</span> <span class="mi">2</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"Set self.idx = 2, fruit = "</span><span class="p">,</span> <span class="n">fl</span><span class="o">.</span><span class="n">selected_fruit</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Init self.idx == 1, fruit =  banana
Set self.idx = 2, fruit =  pear
</pre>
</div>
</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>But now the property also works as a callable to get the fruit of a specific index for our new users:</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">"Using callable without index, fruit = "</span><span class="p">,</span> <span class="n">fl</span><span class="o">.</span><span class="n">selected_fruit</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"Specifying idx = 0, fruit = "</span><span class="p">,</span> <span class="n">fl</span><span class="o">.</span><span class="n">selected_fruit</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Using callable without index, fruit =  pear
Specifying idx = 0, fruit =  apple
</pre>
</div>
</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Using-pd.DataFrame,-pd.Series-or-np.ndarray-as-list-elements">
<a class="anchor" href="#Using-pd.DataFrame,-pd.Series-or-np.ndarray-as-list-elements" aria-hidden="true"><span class="octicon octicon-link"></span></a>Using pd.DataFrame, pd.Series or np.ndarray as list elements<a class="anchor-link" href="#Using-pd.DataFrame,-pd.Series-or-np.ndarray-as-list-elements"> </a>
</h3>
<p>The above should work with most typical python objects, but if you happen to want to return a <code>pd.DataFrame</code> or <code>pd.Series</code> or a <code>np.ndarray</code>, you need to slightly alter the code to get it to work, as these types are special in the way they are initialized. Below however some code that should work for all these types:</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">DefaultDfList</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
    <span class="sd">""""</span>
<span class="sd">    You have the set source_list manually!</span>

<span class="sd">    e.g. </span>

<span class="sd">    dfl = DefaultDfList(df1)</span>
<span class="sd">    dfl.source_list = [df1, df2]</span>
<span class="sd">    """</span>
    <span class="n">_internal_names</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">_internal_names</span><span class="p">)</span> <span class="o">+</span> <span class="p">[</span><span class="s1">'source_list'</span><span class="p">]</span>
    <span class="n">_internal_names_set</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">_internal_names</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">index</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">source_list</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_constructor</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">DefaultDfList</span>


<span class="k">class</span> <span class="nc">DefaultSeriesList</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">):</span>
    <span class="n">_internal_names</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="o">.</span><span class="n">_internal_names</span><span class="p">)</span> <span class="o">+</span> <span class="p">[</span><span class="s1">'source_list'</span><span class="p">]</span>
    <span class="n">_internal_names_set</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">_internal_names</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">index</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">source_list</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_constructor</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">DefaultSeriesList</span>


<span class="k">class</span> <span class="nc">DefaultNpArrayList</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">default_array</span><span class="p">,</span> <span class="n">source_list</span><span class="p">):</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">default_array</span><span class="p">)</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">source_list</span> <span class="o">=</span> <span class="n">source_list</span>
        <span class="k">return</span> <span class="n">obj</span>

    <span class="k">def</span> <span class="nf">__array_finalize__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">obj</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">source_list</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="s1">'source_list'</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">__array_wrap__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">out_arr</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="o">.</span><span class="n">__array_wrap__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">out_arr</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">index</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">source_list</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">default_list</span><span class="p">(</span><span class="n">source_list</span><span class="p">:</span><span class="n">List</span><span class="p">,</span> <span class="n">default_index</span><span class="p">:</span><span class="nb">int</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    Normally gives the default_index item in a list.</span>
<span class="sd">    If used as a callable, you can specify a specific index.</span>
<span class="sd">    </span>
<span class="sd">    Use to make @property that you can pass optional index parameter to</span>
<span class="sd">    """</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">source_list</span><span class="p">[</span><span class="n">default_index</span><span class="p">],</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
        <span class="n">df_list</span> <span class="o">=</span> <span class="n">DefaultDfList</span><span class="p">(</span><span class="n">source_list</span><span class="p">[</span><span class="n">default_index</span><span class="p">])</span>
        <span class="n">df_list</span><span class="o">.</span><span class="n">source_list</span> <span class="o">=</span> <span class="n">source_list</span>
        <span class="k">return</span> <span class="n">df_list</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">source_list</span><span class="p">[</span><span class="n">default_index</span><span class="p">],</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">):</span>
        <span class="n">s_list</span> <span class="o">=</span> <span class="n">DefaultSeriesList</span><span class="p">(</span><span class="n">source_list</span><span class="p">[</span><span class="n">default_index</span><span class="p">])</span>
        <span class="n">s_list</span><span class="o">.</span><span class="n">source_list</span> <span class="o">=</span> <span class="n">source_list</span>
        <span class="k">return</span> <span class="n">s_list</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">source_list</span><span class="p">[</span><span class="n">default_index</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
        <span class="n">a_list</span> <span class="o">=</span> <span class="n">DefaultNpArrayList</span><span class="p">(</span><span class="n">source_list</span><span class="p">[</span><span class="n">default_index</span><span class="p">],</span> <span class="n">source_list</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">a_list</span>

    <span class="k">class</span> <span class="nc">DefaultList</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">source_list</span><span class="p">[</span><span class="n">default_index</span><span class="p">])):</span>
        <span class="k">def</span> <span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">default_value</span><span class="p">,</span> <span class="n">source_list</span><span class="p">):</span>
            <span class="n">obj</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="n">source_list</span><span class="p">[</span><span class="n">default_index</span><span class="p">])</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">default_value</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">obj</span>

        <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">default_value</span><span class="p">,</span> <span class="n">source_list</span><span class="p">):</span>
            <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">source_list</span> <span class="o">=</span> <span class="n">source_list</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">default_type</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="n">default_value</span><span class="p">)</span>

        <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">index</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">source_list</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">DefaultList</span><span class="p">(</span><span class="n">source_list</span><span class="p">[</span><span class="n">default_index</span><span class="p">],</span> <span class="n">source_list</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Conclusion">
<a class="anchor" href="#Conclusion" aria-hidden="true"><span class="octicon octicon-link"></span></a>Conclusion<a class="anchor-link" href="#Conclusion"> </a>
</h1>
<p>So there you have a nice example of how the dynamic nature of python allows you to do some pretty crazy things with your API.</p>
<p>Whether this is a good idea is ofcourse another question :)</p>

</div>
</div>
</div>
</div>



  </div><!-- from https://github.com/utterance/utterances -->
<script src="https://utteranc.es/client.js"
        repo="oegedijk/blog"
        issue-term="title"
        label="blogpost-comment"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script><a class="u-url" href="/blog/python/2020/11/10/callable-properties.html" hidden></a>
</article>
      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/blog/"></data>

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col">
        <p class="feed-subscribe">
          <a href="/blog/feed.xml">
            <svg class="svg-icon orange">
              <use xlink:href="/blog/assets/minima-social-icons.svg#rss"></use>
            </svg><span>Subscribe</span>
          </a>
        </p>
      </div>
      <div class="footer-col">
        <p>A blog about data science, explainable AI, python tricks and more</p>
      </div>
    </div>

    <div class="social-links"><ul class="social-media-list"><li><a rel="me" href="https://github.com/oegedijk" title="oegedijk"><svg class="svg-icon grey"><use xlink:href="/blog/assets/minima-social-icons.svg#github"></use></svg></a></li><li><a rel="me" href="https://twitter.com/oegedijk" title="oegedijk"><svg class="svg-icon grey"><use xlink:href="/blog/assets/minima-social-icons.svg#twitter"></use></svg></a></li></ul>
</div>

  </div>

</footer>
</body>

</html>
